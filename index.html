<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AmpGen: AmpGen</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AmpGen<span id="projectnumber">&#160;2.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title"><a class="el" href="dc/d82/namespace_amp_gen.html">AmpGen</a> </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md__github_workspace_README_tex"></a> <a href="https://github.com/GooFit/AmpGen/actions"><img src="https://github.com/GooFit/AmpGen/workflows/CI/badge.svg" alt="AmpGen Actions Status" style="pointer-events: none;" class="inline"/></a> <a href="./LICENSE"><img src="https://img.shields.io/badge/License-GPL%20v2-blue.svg" alt="License: LGPL v3" style="pointer-events: none;" class="inline"/></a></p>
<p  align="center"></p>
<p ><img src="https://github.com/GooFit/AmpGen/raw/master/doc/figs/logo.png" alt="" class="inline"/> </p>
<p ><a class="el" href="dc/d82/namespace_amp_gen.html">AmpGen</a> is a library and set of applications for fitting and generating multi-body particle decays using the isobar model. It developed out of the MINT project used in the fitting of three and four-body pseudoscalar decays by the CLEO-c and LHCb colloborations. The library can handle the fitting and generation of a wide variety of final states, including those involving fermions and photons, as well as polarised initial states.</p>
<p >Source code for the evaluation of amplitudes is dynamically generated by a custom engine, JIT compiled and dynamically linked to the user programme at runtime, which results in high flexibility and performance.</p>
<h2><a class="anchor" id="autotoc_md0"></a>
Table of Contents</h2>
<ul>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#applications">Applications</a></li>
<li><a href="#examples">Examples</a></li>
<li><a href="#advanced">Advanced</a></li>
<li><a href="https://goofit.github.io/AmpGen/">API documentation</a></li>
<li><a href="#acknowledgements">Acknowledgements</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md1"></a>
Getting started</h2>
<h3><a class="anchor" id="autotoc_md2"></a>
Installation</h3>
<h4><a class="anchor" id="autotoc_md3"></a>
Getting the source</h4>
<p >Clone with git </p><div class="fragment"><div class="line">git clone http://github.com/GooFit/AmpGen/ --recursive</div>
</div><!-- fragment --><p ><a class="anchor" id="autotoc_md4"></a> </p><h5>Build requirements:</h5>
<ul>
<li>cmake &gt;= 3.11.0</li>
<li>C++ compiler with CXX standard &gt;= 14 (gcc &gt;= 4.9.3, clang ~ 5). Defaults to Cxx17 (enable cxx14 with cmake flag <code>-DCMAKE_CXX_STANDARD=14</code> )</li>
<li>ROOT &gt;= 6 with MathMore To (re)configure root with these options, use the additional command line options <code>-Dcxx14 -Dmathmore=ON</code> when configuring the installation of ROOT.</li>
</ul>
<p ><a class="anchor" id="autotoc_md5"></a> </p><h5>Optional:</h5>
<ul>
<li>boost &gt;= 1.67.0 for unit tests</li>
<li>xROOTd for network file access</li>
<li>OpenMP for multithreading</li>
<li>ROOT &gt;= 6 with MathMore and Minuit2 enabled. The external version of Minuit2 provided as an external package of GooFit is used if the ROOT version is not unavailable. To (re)configure root with these options, use the additional command line options <code>-Dcxx14 -Dminuit2=ON -Dmathmore=ON</code> when configuring the installation of ROOT.</li>
</ul>
<h4><a class="anchor" id="autotoc_md6"></a>
Building</h4>
<p >The configuration of the <a class="el" href="dc/d82/namespace_amp_gen.html">AmpGen</a> build is performed by cmake. It is recommended to use a build directory to keep the source tree clean.</p>
<div class="fragment"><div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake ..</div>
<div class="line">make </div>
<div class="line">make install #optional# </div>
</div><!-- fragment --><p> This will build the shared library, several standalone test applications, and a set of unit tests.</p>
<h4><a class="anchor" id="autotoc_md7"></a>
Usage with ROOT</h4>
<p >The library can be used interactively in conjunction with the ROOT C++ interpreter by adding the following lines to the users root login script</p>
<div class="fragment"><div class="line">{c++}</div>
<div class="line"> gSystem-&gt;Load(&quot;path_to_ampgen/build/lib/libAmpGen.so&quot;);</div>
<div class="line"> gROOT-&gt;ProcessLine(&quot;.include path_to_ampgen&quot;);</div>
</div><!-- fragment --><p> <a class="anchor" id="autotoc_md8"></a> </p><h5>LLVM</h5>
<p >You can also build <a class="el" href="dc/d82/namespace_amp_gen.html">AmpGen</a> with LLVM. The only change you might want when using Apple LLVM is to specifically specify the location of the build tool for <a class="el" href="dc/d82/namespace_amp_gen.html">AmpGen</a>'s JIT:</p>
<div class="fragment"><div class="line">-DAMPGEN_CXX=$(which c++)</div>
</div><!-- fragment --><p ><a class="anchor" id="autotoc_md9"></a> </p><h5>LXPLUS</h5>
<p >A valid development environment is required to build the library on LXPLUS and similar. The easiest way to provide this is via cvmfs views where available, as this provides the necessary versions of gcc in addition to the ROOT libraries in a coherent manner, which can be used as</p>
<div class="fragment"><div class="line">source /cvmfs/sft.cern.ch/lcg/views/setupViews.sh LCG_94python3 x86_64-centos7-gcc8-opt</div>
</div><!-- fragment --><p >The LCG versions and binary tag may need to be updated over time.</p>
<p >Several examples of usages of the library are included in apps and examples directories and are built alongside the library. All standalone programs can accept both options files and command line arguments. Also supported is the <code>--help</code> option to print instructions for key arguments to the program.</p>
<h4><a class="anchor" id="autotoc_md10"></a>
Using SIMD instructions.</h4>
<p ><a class="el" href="dc/d82/namespace_amp_gen.html">AmpGen</a> (v &gt; 2.0) can be setup to generate vectorised code for faster evaluation of amplitudes / computation of integrals on compatible hardware. Such extensions can be enabled by setting the providing the flag </p><div class="fragment"><div class="line">-DUSE_SIMD=AVX2d</div>
</div><!-- fragment --><p> to cmake. This tells <a class="el" href="dc/d82/namespace_amp_gen.html">AmpGen</a> that code should be generated using the AVX2 instruction set using double precision. Single precision is also supported, but not recommended for fitting. The support for SIMD instructions is often limited on batch systems, and therefore it is often useful to also have a build with these instruction switched off, which can be done using</p>
<div class="fragment"><div class="line">-DUSE_SIMD=0</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md11"></a>
Options files and decay descriptors</h3>
<p >Options files will generally contain the description of one or more particle decays, as well as other settings such as input/output locations, global flags such as whether complex numbers should be interpreted as cartesian or polar, and other parameters such as the masses and widths of particles is these differ from those given in the PDG.</p>
<p >A minimal example options file for the generator application could contain: </p><div class="fragment"><div class="line">EventType D0 K+ pi- pi- pi+</div>
<div class="line">#                                           Real / Amplitude   | Imaginary / Phase</div>
<div class="line">#                                           Fix?  Value  Step  | Fix?  Value  Step</div>
<div class="line">D0{K*(892)0{K+,pi-},rho(770)0{pi+,pi-}}     2     1      0       2     0      0   </div>
</div><!-- fragment --><p> The EventType specifies the initial and final states requested by the user. This gives the ordering of particles used in input data, in output code, and used in internal computations. This also defines how the amplitude source code must be interfaced with external packages, i.e. MC generators such as EvtGen.</p>
<p >The decay products of a particle are enclosed within curly braces, for example </p><div class="fragment"><div class="line">K*(892)0{K+,pi-}</div>
</div><!-- fragment --><p> describes an excited vector kaon decaying into a charged kaon and pion. For more details about the API for describing particle decays, see <a href="https://goofit.github.io/AmpGen/de/dd7/class_amp_gen_1_1_particle.html">AmpGen::Particle</a> The other numbers on the lines that describe the decays parameterise the coupling to this channel, either in terms of real and imaginary parts or an amplitude and a phase. Each parameter is specified in terms of three numbers: the <em>fix</em> flag, the initial value, and the step size. The possible options for the <em>fix</em> flag, which can be specified either by name or via an integer key (0,1,2,3,4), are:</p>
<ul>
<li>Free (fix=0) and a step size of not 0.</li>
<li>Hide (fix=1)</li>
<li>Fixed (fix=2, for historical reasons)</li>
<li>Compile-Time-Constant (fix=3) which indicates that the parameter should be treated as a (JIT) compile time constant, which in some cases allows for more aggressive optimisations to be performed.</li>
<li>Blind (fix=4) indicates a parameter should be blind, meaning its true value will be hidden from the user to prevent unintentionally biasing analysis. For details, see <a href="#parameter-blinding">Blinding</a>.</li>
</ul>
<p >These options can be used in the <a class="el" href="dc/d82/namespace_amp_gen.html">AmpGen</a> application, which is described below.</p>
<p >Decays can either be specified fully inline, as above, or split into multiple steps, which is useful for treating the so called <em>cascade</em> decays, an example of which is shown below. </p><div class="fragment"><div class="line">D0{K(1)(1270)+,pi-}                         0     1      0.1       0     0      0.1   </div>
<div class="line"> </div>
<div class="line">K(1)(1270)+{rho(770)0{pi+,pi-},K+}          2     1      0         2     0      0</div>
<div class="line">K(1)(1270)+{K*(892)0{K+,pi-},pi+}           0     1      0.1       0     0      0.1</div>
</div><!-- fragment --><p> The production/decay couplings of the \(K_1(1270)^+\) resonance are now defined in terms of the coupling to the \(\rho(770)^0 K^+\) channel, which can be useful in making comparisons between different production modes of a resonance. Additional care must be taken in such a case so as not to introduce redundant degrees of freedom.</p>
<p >Configuration can be split over multiple files by the using <em>Import</em> keyword, for example, to import the parameters for the parameters associated with the isoscalar K-matrix, the line </p><div class="fragment"><div class="line">Import $AMPGENROOT/options/kMatrix.opt</div>
</div><!-- fragment --><p >can be added to options file. Multiple user configuration files can also be specified by including multiple files on the command line.</p>
<h4><a class="anchor" id="autotoc_md12"></a>
PDF Types</h4>
<p ><a class="el" href="dc/d82/namespace_amp_gen.html">AmpGen</a> supports several different types of probability density functions (PDFs), which are detailed in this section.</p>
<p ><a class="anchor" id="autotoc_md13"></a> </p><h5>CoherentSum</h5>
<p >The most common type of PDF is the CoherentSum. In this case, the total amplitude is given by the sum of amplitudes, weighted by complex coefficients. At a position in the phase space \(\mathbf{x}\), the transition amplitude \(\mathcal{T}\) is given by:</p>
<p >\(\mathcal{T}(\mathbf{x}) = \sum_{k} g_k A_k (\mathbf{x})\)</p>
<p >and the corresponding probability density is proportional to \(\mathcal{P}(\mathbf{x})\propto \left|\mathcal{T}(\mathbf{x})\right|^2\). The CoherentSum is the default amplitude in many cases, and is used to describe the decay of a single, (pseudo)scalar particle to two or more (pseudo)scalar decay products.</p>
<p ><a class="anchor" id="autotoc_md14"></a> </p><h5>PolarisedSum</h5>
<p >The initial and/or final state(s) may also carry spin, in which case the spin states must also be summed. The transition matrix can be written in the isobar model as</p>
<p >\(\mathcal{T}_{if} = \sum_k g_k \mathcal{T}^{k}_{if}(\mathbf{x})\),</p>
<p >where \(i\) and \(f\) label the initial and final states, respectively. As these states are in principal observables, the indices related to spin must be summed incoherently. The probability density function in this case is therefore given by</p>
<p >\(\mathcal{P}(\mathbf{x}) = \sum_{if} \hat{\rho}_{ij} T_{if}(\mathbf{x}) T^{*}_{jf}(\mathbf{x}) \),</p>
<p >where \(\hat{\rho}\) is the relevant density matrix for the initial state, which is given by 1 for a scalar initial state. For a spin- \(\frac{1}{2}\) state, the density matrix can be parameterised in terms of a polarisation vector \(p_i\) and the Pauli matrices \(\sigma_i\), and is given by:</p>
<p >\(\hat{\rho} = I + \sigma_i p_i\)</p>
<p >For a spin-1 initial state, the density matrix is parameterised in terms of the Gell-Mann matrices, \(\lambda_k\), as</p>
<p >\(\hat{\rho} = I + \lambda_k p_k\),</p>
<p >where now the polarisation 'vector' \(p_k\) has 8 components.</p>
<p ><a class="anchor" id="autotoc_md15"></a> </p><h5>IncoherentSum</h5>
<p >An alternative model is the IncoherentSum, which may be useful to describe the probability density of a background contribution that contains incoherent sources with several different resonances. Generally, such models are only useful for relatively small backgrounds in relatively pure samples, as in general background contributions cannot be described with such a simple parameterisation. In this case, the probability is given by an incoherent sum of amplitudes:</p>
<p >\(\mathcal{P}(\mathbf{x}) = \sum_k g_k^2 \left| A_k \right|^2 \)</p>
<h2><a class="anchor" id="autotoc_md16"></a>
Applications</h2>
<p >This section details the prebuilt command line applications that use the <a class="el" href="dc/d82/namespace_amp_gen.html">AmpGen</a> library for some common functionality, such as generating Toy Monte Carlo samples and debugging amplitudes.</p>
<h3><a class="anchor" id="autotoc_md17"></a>
Table of contents</h3>
<ul>
<li><a href="#AmpGen">AmpGen</a></li>
<li><a href="#debugger">Debugger</a></li>
<li><a href="#LibDiff">LibDiff</a></li>
<li><a href="#DataConverter">DataConverter</a></li>
</ul>
<h3><a class="anchor" id="autotoc_md18"></a>
AmpGen</h3>
<p >The standalone generator (named <a class="el" href="dc/d82/namespace_amp_gen.html">AmpGen</a>) is used as:</p>
<div class="fragment"><div class="line">AmpGen.exe MyOpts.opt --nEvents=10000 --Output=output.root</div>
</div><!-- fragment --><p >where MyOpts.opt contains the options described in the previous section that describe the decay the user wishes to generate, and the optional arguments <code>nEvents</code> and <code>Output</code> given the number of events requested and the output file, respectively. The full list of application specific arguments can be obtained by:</p>
<div class="fragment"><div class="line">AmpGen.exe --help </div>
</div><!-- fragment --><p >The output includes a tree (DalitzEventList) of candidates with the full four-vectors, as well as one- and two-dimensional projections, an example of which is shown below:</p>
<p ><img src="doc/figs/k3pi_s01.svg" alt="" style="pointer-events: none;" width="300" class="inline"/> </p>
<p >Several models for different \(D^0\) decays published by the LHCb collaboration are included in the options directory, in addition to several other decay modes to demonstrate different features. These options often do not include EventTypes so as they can be included as part of a larger decay chain if required. For example, to generate \(10^6\) toy \(D^0\to K^- \pi^+ \pi^+ \pi^-\) decays, the type of the events requested must also be specified:</p>
<div class="fragment"><div class="line">AmpGen.exe options/D02Kpipipi.opt --EventType &quot;D0 K- pi+ pi+ pi-&quot; --nEvents 1000000</div>
</div><!-- fragment --><p >The standalone generator can also be used to only produce the source code that evaluates the amplitude, to be used by other generators such as EvtGen. In this case, the PDF is automatically normalised such that \(\mathcal{P}_{\text{max}} &lt; 1\) . The code can be generated and compiled into a shared library as follows </p><div class="fragment"><div class="line">AmpGen.exe MyOpts.opt --Output=MyModel.cpp --SourceOnly</div>
<div class="line">g++ -Ofast -shared -rdynamic --std=c++14 -fPIC MyModel.cpp -o MyModel.so</div>
</div><!-- fragment --><p> Decays can also be specified entirely on the command line in order to quickly study the distributions of different decay modes. For example, to generate a sample of 10000 \(\Lambda_b \to p K^{*-}\) decays,</p>
<div class="fragment"><div class="line">AmpGen.exe --Decay &quot;Lambda(b)0{p+,K*(892)bar-{K-,pi0}}&quot; --nEvents 10000 --Type PolarisedSum </div>
</div><!-- fragment --><p >The flag <code>Type</code> is used to specify that the initial and/or final states includes at least one particle carrying spin, and thus polarisation must be taken into account. The output is both the full event kinematics, as well as projections of the different invariant masses shown below:</p>
<div> <img src="doc/figs/lb2pKpi_s01.svg" alt="" style="pointer-events: none;" width="300" class="inline"/> <img src="doc/figs/lb2pKpi_s02.svg" alt="" style="pointer-events: none;" width="300" class="inline"/> </div> <h4><a class="anchor" id="autotoc_md19"></a>
Phase space generators</h4>
<p >Generating events consists of two phases. Firstly, the kinematics of candidates are generated according to some distribution, by default uniform in the phase space. The target distribution, \(\mathcal{P}(\mathbf{x})\) , is then obtained using the accept-reject method. A candidate generated at position \(\mathbf{x}\) in the phase space is retained on the condition that</p>
<p >\(\mathcal{P}(\mathbf{x}) &gt; \mathcal{P}_{\text{max}} \times \texttt{Uniform}(0,1) \),</p>
<p >where \(\mathcal{P}_{\text{max}}\) is the largest possible value of \(\mathcal{P}(\mathbf{x})\) , and \(\texttt{Uniform}(0,1)\) is a random number uniformly drawn between 0 and 1.</p>
<p >​ The generation can be made more efficient by making the first step produce candidates that are distributed more closely to the full distribution than the uniform phase space. In particular, this is relevant for producing very narrow structures such as the \(J/\psi\) resonance efficiently. To use this option, the flag <code>PhaseSpace</code> should be set to the value <code>TreePhaseSpace</code>. For example, to generate a sample of \(10^6\) \(\Lambda_b^0 \to J/\psi \left[\mu^+\mu^-\right]\Lambda(1405)^0 \left[p^+ \pi^-\right]\) decays:</p>
<div class="fragment"><div class="line">AmpGen.exe --Decay &quot;Lambda(b)0{J/psi0{mu+,mu-},Lambda(1405)0{p+,pi-}}&quot; --nEvents 1000000 --Type PolarisedSum --PhaseSpace TreePhaseSpace</div>
</div><!-- fragment --><p >Two example projections are shown below, of the dimuon invariant mass with essentially no width, which would be virtually impossible to generate with a uniform distribution and the naive accept-reject method, and the combined mass of the dimuon with the proton from the \(\Lambda(1405)^0\) decay:</p>
<div> <img src="doc/figs/lb2jspiL_s01.svg" alt="" style="pointer-events: none;" width="300" class="inline"/> <img src="doc/figs/lb2jspiL_s012.svg" alt="" style="pointer-events: none;" width="300" class="inline"/> </div> <h3><a class="anchor" id="autotoc_md20"></a>
Debugger</h3>
<p >The debugger application is a tool for producing verbose information debugging for amplitudes and models. It is used on an options file as</p>
<div class="fragment"><div class="line">Debugger.exe MyOpts.opt</div>
</div><!-- fragment --><p> which calculates each amplitude at a randomly generated point in phase space, as well as calculating the total amplitude accounting for complex couplings.</p>
<p >A more useful application is the <em>verbose</em> debugging mode which can be activated by</p>
<div class="fragment"><div class="line">Debugger.exe MyOpts.opt --CoherentSum::Debug</div>
</div><!-- fragment --><p> which produces a large number of intermediate steps in the calculation of each amplitude, which are added to the calculation using the ADD_DEBUG and ADD_DEBUG_TENSOR macros in the code generation. For example, in src/Lineshapes/BW.cpp. If the model is a PolarisedSum, i.e. handles spin in the initial/final state, the flag PolarisedSum::Debug should be used instead of CoherentSum::Debug.</p>
<h3><a class="anchor" id="autotoc_md21"></a>
LibDiff</h3>
<h3><a class="anchor" id="autotoc_md22"></a>
DataConvertor</h3>
<h2><a class="anchor" id="autotoc_md23"></a>
Examples</h2>
<h3><a class="anchor" id="autotoc_md24"></a>
SignalOnlyFitter</h3>
<p >An example fitter is provided in <em>examples/SignalOnlyFitter.cpp</em>, which as the name suggests only has a single signal component in the fit. The free parameters of the fit are specified in the same way as the Generator, with the additional relevant slots being <em>DataSample</em> which specifies the signal sample to fit, which is presumed to already have the selection applied, and <em>Branches</em> which takes a list of branch names, and defaults to the format used by the Generator. More details can be found with </p><div class="fragment"><div class="line">SignalOnlyFitter.exe --help</div>
</div><!-- fragment --><p> For example, the fitter can be used to fit a toy MC sample generated by the generator by running: </p><div class="fragment"><div class="line">AmpGen.exe MyOpts.opt --nEvents 100000</div>
<div class="line">SignalOnlyFitter.exe MyOpts.opt --DataSample Generate_Output.root</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md25"></a>
Advanced</h2>
<p >This section contains miscellaneous details on more advanced functionality, including using python bindings and alternative parameterisations of the spin factors.</p>
<h3><a class="anchor" id="autotoc_md26"></a>
Table of contents</h3>
<ul>
<li><a href="#python-bindings">Python Bindings</a></li>
<li><a href="#particle-properties-and-lineshape-parameters">Particle Properties and Lineshape parameters</a></li>
<li><a href="#fit-parameters-and-expressions">Fit parameters and expressions</a></li>
<li><a href="#parameter-blinding">Parameter Blinding</a></li>
<li><a href="#spin-formalisms">Spin Formalisms</a></li>
<li><a href="#quasiparticles">Quasiparticles</a></li>
</ul>
<h3><a class="anchor" id="autotoc_md27"></a>
Python Bindings</h3>
<p >Models built into a shared library can be used in python using the following flags: </p><div class="fragment"><div class="line">./AmpGen.exe MyOpts.opt --Output=MyFile.cpp --SourceOnly --OutputEvents=events.csv --IncludePythonBindings</div>
</div><!-- fragment --><p> where normalisation events are also output for testing purposes in events.csv. This can then be used with the python bindings in ampgen.py: <br  />
 </p><div class="fragment"><div class="line"><span class="keyword">from</span> ampgen <span class="keyword">import</span> FixedLib</div>
<div class="line">model = FixedLib(<span class="stringliteral">&#39;MyModel.so&#39;</span>)</div>
<div class="line">print(model.matrix_elements[0]) <span class="comment"># Print first matrix element</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div>
<div class="line">data = pd.read_csv(<span class="stringliteral">&#39;events.csv&#39;</span>, nrows=100_000)</div>
<div class="line">fcn1 = model.FCN_all(data)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># or, a bit slower, but just to show flexibility:</span></div>
<div class="line">fcn2 = data.apply(model.FCN, axis=1)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md28"></a>
Particle Properties and Lineshape parameters</h3>
<p >The particles available and their default properties can be found in <em>options/mass_width.csv</em> using the MC format of the 2008 PDG. Additional pseudoparticles, such as nonresonant states and terms for use in conjunction with K-matrices are defined by <em>options/MintDalitzSpecialParticles.csv</em>. Any additional user defined particles should be added here. For the default lineshape (the relavistic Breit-Wigner or BW), there are three parameters: The mass, the width and the Blatt-Weisskopf radius. These default to their PDG values, but can be overridden in the options file with parameters: <em>particleName</em>_mass, <em>particleName</em>_width, <em>particleName</em>_radius. To vary the mass of the \(K_1(1270)^+\) meson, the line: </p><div class="fragment"><div class="line">K(1)(1270)+_mass 0 1.270 0.01</div>
</div><!-- fragment --><p> could be added to the user configuration. Other lineshapes may define other parameters, for example channel couplings or pole masses in the case of the K-matrices, can be set or varied in a similar manner.</p>
<h3><a class="anchor" id="autotoc_md29"></a>
Fit parameters and expressions</h3>
<p >Parameters can either be specified by three parameters, in the case of a scalar parameter such as a mass or a width, or with six parameters in the case of a complex parameter such as a coupling. Upper and lower bounds on parameters can also be set by specifying a parameter with five parameters or ten parameters for a scalar or complex, respectively. For example, if we wished to vary the mass of the \(K_1(1270)^+\) meson in the above example, but restricting the allowed values in the range \([0.0,2.0]\,\mathrm{GeV}\): </p><div class="fragment"><div class="line">K(1)(1270)+_mass 0 1.27 0.01 0.0 2.0</div>
</div><!-- fragment --><p >Parameters can also be related to each other via expressions, Suppose for example we have \(K_1(1270)^+\) and \(K_1(1270)^-\) in the same fit (for example, in \(D^0 \to K^- K^+ \pi^- \pi^+\)) The properties of one can be allowed to vary, for example the \(K_1(1270)^+\), and the other fixed to the same value, using: </p><div class="fragment"><div class="line">K(1)(1270)+_mass 0 1.27 0.01 0.0 2.0</div>
<div class="line">K(1)(1270)bar-_mass = K(1)(1270)+_mass</div>
</div><!-- fragment --><p> Parameter expressions are whitespace delimited due to the abundance of <b>odd</b> glyphs such as brackets and +/- in the names of parameters. Expressions support the binary operations \((+,-,/,* )\), as well as common unary functions such as sqrt, trigonometric functions etc.</p>
<h3><a class="anchor" id="autotoc_md30"></a>
Parameter Blinding</h3>
<p >Parameters can blinded, that is, their actual values obscured from the user to avoid unintentional biasing of an analysis. For example, suppose that a blind analysis of the \(K_1(1270)^-\) mass were to be performed. The mass variable in the options file would be declared as </p><div class="fragment"><div class="line">K(1)(1270)+_mass Blind 1.27 0.01 0.0 2.0 </div>
</div><!-- fragment --><p> The mass will now be shifted by an amount specified by the variable <em>variableName</em>_blind, which must also be declared by the user. In order to be useful, the amount the variable is shifted by is normally kept secret from the user. For this purpose, a special function <em>Secret</em> is implemented that can be used in expressions. </p><div class="fragment"><div class="line">K(1)(1270)+_mass Blind 1.27 0.01 0.0 2.0</div>
<div class="line">K(1)(1270)+_mass_blind = Secret ( my_secret , -1 , 1 )</div>
</div><!-- fragment --><p> where the arguments are a key that generates a unique secret per key, and the minimal and maximal value of the shift.</p>
<h3><a class="anchor" id="autotoc_md31"></a>
Spin Formalisms</h3>
<p ><a class="el" href="dc/d82/namespace_amp_gen.html">AmpGen</a> implements both the covariant tensor (or Rarita-Schwinger) and canonical helicity formalism for describing the angular momentum component of decays. Both formalisms refer to states of well-defined orbital angular momentum, as opposed to the helicity states, as the states with well-defined orbital angular momentum have a straightforward parity and momentum dependences. The default formalism is the covariant tensor formalism, but this can be switched to the canonical formalism changing the flag </p><div class="fragment"><div class="line">Particle::SpinFormalism Canonical</div>
</div><!-- fragment --><p> in the options file. The spin formalism for an individual decay chain can be specified by changing the attribute SpinFormalism in the decay descriptor. For example, </p><div class="fragment"><div class="line">D0[SpinFormalism=Canonical]{K*(892)bar0,rho(770)0}</div>
</div><!-- fragment --><p> selects the S-wave of the \(K^* \rho\) system. The user can also specify systems of helicity couplings in the canonical formalism, using the attribute <em>helAmp</em>. For example, suppose the transversity amplitudes were used rather than the canonical, then the user can specify </p><div class="fragment"><div class="line">D0[SpinFormalism=Canonical;helAmp=Long]{K*(892)bar0,rho(770)0}</div>
<div class="line">D0[SpinFormalism=Canonical;helAmp=t1]{K*(892)bar0,rho(770)0}</div>
<div class="line">D0[SpinFormalism=Canonical;helAmp=t2]{K*(892)bar0,rho(770)0}</div>
</div><!-- fragment --><p> For the longitudinal and two transverse amplitudes. These must then be defined by the user in terms of the helicity amplitudes in the following structure: </p><div class="fragment"><div class="line">Long {</div>
<div class="line">  1.0 0 0</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">t1 {</div>
<div class="line">  0.707106781 +1 +1</div>
<div class="line">  0.707106781 -1 -1</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">t2 {</div>
<div class="line">   0.707106781 +1 +1</div>
<div class="line">  -0.707106781 -1 -1</div>
<div class="line">}</div>
</div><!-- fragment --><p> That is specified as sets of three numbers, firstly the coupling, and then the two particle helicities. So in this example, the longitudinal amplitude is the \(00\) helicity state, while the two transverse amplitudes and the sum and difference of the two other helicity amplitudes.</p>
<h3><a class="anchor" id="autotoc_md32"></a>
Quasiparticles</h3>
<p >Quasiparticles are fictional decaying particles that can be implemented in the decay chain for a variety of different purposes. The original use case was to group some amplitudes with the same quantum numbers with couplings that want to be factorised. For example, for the \(I=0\) \(S\)-wave, the K matrix description may be used. The coupling from the initial state may be written as</p>
<div class="fragment"><div class="line">D0{K0S0,NonResS0} ...</div>
</div><!-- fragment --><p> The quasiparticle <em>NonResS0</em> can then be decayed to the final state via the K matrix lineshape(s) </p><div class="fragment"><div class="line">NonResS0[kMatrix.pole.0]{pi+,pi-} ...</div>
<div class="line">NonResS0[kMatrix.pole.1]{pi+,pi-} ...</div>
<div class="line">...</div>
</div><!-- fragment --><p> where each of the .X is one of the terms of the (pole) production vector. In this example, an equivalent formulation would be </p><div class="fragment"><div class="line">D0{K0S0,NonResS0[kMatrix.pole.0]{pi+,pi-}} ...</div>
<div class="line">D0{K0S0,NonResS0[kMatrix.pole.1]{pi+,pi-}} ...</div>
<div class="line">...</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md33"></a>
Acknowledgements</h2>
<p >The development of this software has been supported by the National Science Foundation under grant PHY-1414736 and through a subcontract under Cooperative Agreement OAC-1836650. Any opinions, findings, and conclusions or recommendations expressed in this material are those of the developers and do not necessarily reflect the views of the National Science Foundation.</p>
<div> <img src="https://github.com/GooFit/AmpGen/raw/master/doc/figs/UC_ID_PrimaryBlackRed.png" alt="" class="inline"/> <img src="https://github.com/GooFit/AmpGen/raw/master/doc/figs/Iris-hep-3-regular-complete.png" alt="" class="inline"/> <img src="https://github.com/GooFit/AmpGen/raw/master/doc/figs/NSF_4-Color_bitmap_Logo.png" alt="" class="inline"/> </div> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Sep 14 2021 07:04:20 for AmpGen by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
